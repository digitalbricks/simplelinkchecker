<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Link Checker</title>
</head>
<style>
    body{
        font-family: Arial, Arial, Helvetica, sans-serif;
    }
    .container{
        width: 98%;
        margin: 0 auto;
        max-width: 1400px;
    }
    textarea{
        width: 100%;
        height: 400px;
        display: block;
        margin-bottom: 1em;
    }
    button{
        font-size: 1.2em;
    }
    table{
        width: 100%;
        margin-bottom: 3em;
        margin-top: 3em;
        border-collapse: collapse;
        transition: all 1s linear;
        opacity: 1;
    }
    table.invisible{
        opacity: 0;
    }
    td{
        border-bottom: 1px solid #ccc;
    }
    th{
        text-align: left;
        border-bottom: 4px solid #ccc;
        text-transform: uppercase;
        font-size: 0.8em;
        letter-spacing: 0.1em;
    }
    td,
    th{
        padding: 0.5em;
    }
    tr.done td{
        text-transform: uppercase;
        font-weight: bold;
        color: #fff;
        background-color: #48b512;
    }
    th.header_code{
        width: 100px;
    }
    /* coloring status codes */
    tr.code_200 td{
        background-color: #c6f9d2;
    }
    tr.code_301 td{
        background-color: #f7f9c6;
    }
    tr.code_302 td{
        background-color: #f9e1c6;
    }
    tr.code_404 td,
    tr.code_500 td{
        background-color: #f7a8a7;
    }
</style>
<body>


    <div class="container">
        <h1>Simple Link Checker <small>v0.1</small></h1>
        <textarea name="urls_input" id="urls_input" cols="100" rows="30" placeholder="Paste URLs here, one per line"></textarea>
        <button id="submit">Test URLs</button>
    
        <table class="invisible">
            <thead>
                <tr>
                    <th class="header_url">Request URL</th>
                    <th class="header_code">Status</th>
                    <th class="header_target">Redirect target</th>
                </tr>
            </thead>
            <tbody id="output">
               <!-- will be populated via js --> 
            </tbody>
        </table>
    </div>
    





    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            $('#submit').click(function(){
                // make table visible
                $('table.invisible').removeClass('invisible');

                // disable submit button
                $('#submit').attr("disabled", "disabled");


                // text lines to array
                // Source: https://stackoverflow.com/questions/8479053/convert-textareas-string-value-to-javascript-array-separated-by-new-lines
                var lines = $('#urls_input').val().split(/\n/);
                var urls = [];
                for (var i=0; i < lines.length; i++) {
                    // only push this line if it contains a non whitespace character.
                    if (/\S/.test(lines[i])) {
                        urls.push($.trim(lines[i]));
                    }
                }

                // send ajax requests to all that
                // source: https://stackoverflow.com/questions/24705401/jquery-ajax-with-array-of-urls
                $.when.apply($, urls.map(function(url) {
                    return $.ajax({
                        type: 'POST',
                        url: 'proxy.php',
                        data: url,
                        dataType: 'text',
                        success: function(responseData, textStatus, jqXHR) 
                        {
                            addRowToTable(responseData, textStatus, jqXHR);
                        },
                        error: function (responseData, textStatus, errorThrown) 
                        {
                            console.warn(responseData, textStatus, errorThrown);
                        }
                    })
                })).done(function() {
                    finished();
                });
            });
        });


        // function for adding result row to output table
        function addRowToTable(responseData, textStatus, jqXHR){
            response = JSON.parse(responseData);
            console.log(response);
            $('<tr class="code_'+response.status+'"><td>'+response.url+'</td><td>'+response.status+'</td><td>'+response.target+'</td></tr>').appendTo($('#output'));
        }

        // function for adding a final line at the end of the table
        function finished(){
            $('<tr class="done"><td colspan="3">Done</td></tr>').appendTo($('#output'));

            // re-enable submit button
            $('#submit').prop("disabled", false);
        }

    </script>
</body>
</html>